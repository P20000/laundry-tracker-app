# Render Blueprint for the Smart Wardrobe App Monorepo (Dockerized Services Only)

services:

# -------------------------------------------------
# 1. Managed Database (MySQL) - Unchanged
# -------------------------------------------------
- type: pserv
  name: smart-wardrobe-db
  plan: free
  disk:
    name: mysqldata
    sizeGB: 1
  env: mysql

# -------------------------------------------------
# 2. Backend API (Node.js/Express) - Uses backend/Dockerfile
# -------------------------------------------------
- type: web
  name: api
  env: docker # FORCED DOCKER BUILD
  plan: free 
  dockerfilePath: backend/Dockerfile # Explicitly point to Dockerfile
  
  # The START command is now handled inside backend/Dockerfile.
  # We just set the necessary environment variables here.
  envVars:
    - key: DATABASE_URL
      fromDatabase:
        name: smart-wardrobe-db
        property: connectionString
    - key: NODE_ENV
      value: production
  
  autoDeploy: true
  port: 3000

# -------------------------------------------------
# 3. Frontend (React/Nginx) - Uses frontend/Dockerfile
# -------------------------------------------------
- type: web
  name: frontend
  env: docker # FORCED DOCKER BUILD
  plan: free
  dockerfilePath: frontend/Dockerfile # Explicitly point to Dockerfile
  
  # The START command is now handled inside frontend/Dockerfile.
  envVars:
    - key: VITE_APP_API_URL
      value: "https://${{RENDER_EXTERNAL_HOSTNAME}}/api"
      
  autoDeploy: true
  port: 80