# Render Blueprint for the Smart Wardrobe App Monorepo (Final attempt at fixing build context)

services:

# -------------------------------------------------
# 1. Managed Database (MySQL) - Unchanged
# -------------------------------------------------
- type: pserv
  name: smart-wardrobe-db
  plan: free
  disk:
    name: mysqldata
    sizeGB: 1
  env: mysql

# -------------------------------------------------
# 2. Backend API (Node.js/Express) - Requires explicit pathing for prisma/npm
# -------------------------------------------------
- type: web
  name: api
  rootDir: backend 
  env: node
  plan: free 
  
  # CRITICAL FIX: Explicitly run NPM commands from the 'backend' folder
  buildCommand: "cd backend && npm install && npm run build:ts"
  startCommand: "cd backend && npx prisma migrate deploy && node dist/index.js"
  healthCheckPath: "/health"
  
  envVars:
    - key: DATABASE_URL
      fromDatabase:
        name: smart-wardrobe-db
        property: connectionString
    - key: NODE_ENV
      value: production
  
  autoDeploy: true
  port: 3000

# -------------------------------------------------
# 3. Frontend (React/Nginx) - Docker is better for static assets/Nginx
# -------------------------------------------------
- type: web
  name: frontend
  # Render automatically detects the Dockerfile in the rootDir.
  # We should NOT define buildCommand/startCommand here as that enables the failing Node buildpack.
  rootDir: frontend
  env: docker # CRITICAL: Force using the Dockerfile
  plan: free
  
  envVars:
    - key: VITE_APP_API_URL
      value: "https://${{RENDER_EXTERNAL_HOSTNAME}}/api"
      
  autoDeploy: true
  port: 80